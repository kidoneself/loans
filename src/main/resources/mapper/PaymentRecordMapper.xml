<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.finance.loans.mapper.PaymentRecordMapper">

    <!-- 结果映射 -->
    <resultMap id="PaymentRecordResultMap" type="com.finance.loans.model.PaymentRecord">
        <id property="id" column="id"/>
        <result property="loanId" column="loan_id"/>
        <result property="scheduleId" column="schedule_id"/>
        <result property="amount" column="amount"/>
        <result property="paymentDate" column="payment_date"/>
        <result property="paymentType" column="payment_type"/>
        <result property="note" column="note"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <!-- 根据贷款ID查询还款记录 -->
    <select id="findByLoanId" resultMap="PaymentRecordResultMap">
        SELECT * FROM payment_record 
        WHERE loan_id = #{loanId} 
        ORDER BY payment_date DESC
    </select>

    <!-- 查询指定月份的还款记录 -->
    <select id="findByMonth" resultMap="PaymentRecordResultMap">
        SELECT * FROM payment_record 
        WHERE YEAR(payment_date) = #{year} AND MONTH(payment_date) = #{month}
        ORDER BY payment_date DESC
    </select>

    <!-- 查询指定日期范围的还款记录 -->
    <select id="findByDateRange" resultMap="PaymentRecordResultMap">
        SELECT * FROM payment_record 
        WHERE payment_date BETWEEN #{startDate} AND #{endDate}
        ORDER BY payment_date DESC
    </select>

    <!-- 根据ID查询 -->
    <select id="findById" resultMap="PaymentRecordResultMap">
        SELECT * FROM payment_record WHERE id = #{id}
    </select>

    <!-- 插入还款记录 -->
    <insert id="insert" parameterType="com.finance.loans.model.PaymentRecord" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO payment_record (
            loan_id, schedule_id, amount, payment_date, payment_type, note
        ) VALUES (
            #{loanId}, #{scheduleId}, #{amount}, #{paymentDate}, #{paymentType}, #{note}
        )
    </insert>

    <!-- 删除记录 -->
    <delete id="deleteById">
        DELETE FROM payment_record WHERE id = #{id}
    </delete>

</mapper>
