<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´·æ¬¾ç®¡ç† - ä¸ªäººèµ„é‡‘ç®¡ç†ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-bottom: 50px;
        }
        .card {
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            border: none;
        }
        .container {
            max-width: 1200px;
        }
        .table {
            background: white;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html" style="font-weight: bold; font-size: 20px;">
                <i class="bi bi-wallet2"></i> è´·æ¬¾ç®¡ç†ç³»ç»Ÿ
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html"><i class="bi bi-house-door"></i> é¦–é¡µ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="loans.html"><i class="bi bi-credit-card"></i> è´·æ¬¾ç®¡ç†</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="income-expenses.html"><i class="bi bi-cash-stack"></i> æ”¶å…¥æ”¯å‡º</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="repayment-plan.html"><i class="bi bi-calendar-check"></i> è¿˜æ¬¾è®¡åˆ’ â­</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="forecast.html"><i class="bi bi-graph-up"></i> å›ºå®šæ”¶æ”¯</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="salary-cycle.html"><i class="bi bi-calendar-range"></i> å·¥èµ„å‘¨æœŸ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="calendar.html"><i class="bi bi-calendar3"></i> è¿˜æ¬¾æ—¥å†</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="debt-trend.html"><i class="bi bi-graph-down"></i> å€ºåŠ¡è¶‹åŠ¿</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- æ±‡æ€»ä¿¡æ¯ -->
        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h6 class="text-muted">æ€»è´Ÿå€º</h6>
                        <h3 class="amount-negative" id="totalDebt">Â¥0.00</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h6 class="text-muted">æ¯æœˆè¿˜æ¬¾</h6>
                        <h3 id="monthlyPaymentSummary">Â¥0.00</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h6 class="text-muted">æ´»è·ƒè´·æ¬¾</h6>
                        <h3 id="activeCount">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h6 class="text-muted">å·²ç»“æ¸…</h6>
                        <h3 id="completedCount">0</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¹³å°æ±‡æ€» -->
        <div class="card mb-4">
            <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <i class="bi bi-building"></i> å¹³å°æ±‡æ€»
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm mb-0">
                        <thead>
                            <tr>
                                <th>å¹³å°åç§°</th>
                                <th class="text-end">æ€»è´Ÿå€º</th>
                                <th class="text-center">è´·æ¬¾ç¬”æ•°</th>
                                <th class="text-end">æœˆè¿˜æ¬¾</th>
                            </tr>
                        </thead>
                        <tbody id="platformSummary">
                            <tr>
                                <td colspan="4" class="text-center text-muted">åŠ è½½ä¸­...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- è´·æ¬¾åˆ—è¡¨ -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-list"></i> è´·æ¬¾åˆ—è¡¨</span>
                <div class="btn-group">
                    <button class="btn btn-success btn-sm" onclick="window.location.href='chat-input.html'">
                        <i class="bi bi-chat-dots"></i> ğŸ’¬ æ™ºèƒ½å½•å…¥
                    </button>
                    <button class="btn btn-primary btn-sm" onclick="showAddModal()">
                        <i class="bi bi-plus-circle"></i> æ·»åŠ è´·æ¬¾
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>è´·æ¬¾åç§°</th>
                                <th>å¹³å°</th>
                                <th>å‰©ä½™é‡‘é¢</th>
                                <th>æ¯æœŸè¿˜æ¬¾</th>
                                <th>è¿˜æ¬¾æ—¥</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="loansList"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘è´·æ¬¾æ¨¡æ€æ¡† -->
    <div class="modal fade" id="loanModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">æ·»åŠ è´·æ¬¾</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="loanForm">
                        <input type="hidden" id="loanId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">è´·æ¬¾åç§° *</label>
                                <input type="text" class="form-control" id="loanName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">å¹³å°</label>
                                <input type="text" class="form-control" id="platform" placeholder="å¦‚ï¼šæ‹æ‹è´·">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">æ¯æœŸè¿˜æ¬¾ *</label>
                                <input type="number" class="form-control" id="monthlyPayment" step="0.01" required 
                                       oninput="calculateRemainingAmount()" onchange="calculateRemainingAmount()">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">è¿˜æ¬¾æ—¥ *</label>
                                <input type="number" class="form-control" id="paymentDay" min="1" max="31" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">æ€»æœŸæ•° *</label>
                                <input type="number" class="form-control" id="totalPeriods" required 
                                       oninput="calculateRemainingAmount()" onchange="calculateRemainingAmount()">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">å·²è¿˜æœŸæ•° *</label>
                                <input type="number" class="form-control" id="paidPeriods" value="0" required 
                                       oninput="calculateRemainingAmount()" onchange="calculateRemainingAmount()">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">å‰©ä½™æœŸæ•°</label>
                                <input type="number" class="form-control" id="remainingPeriods" readonly style="background-color: #f0f0f0;">
                            </div>
                        </div>
                        <div class="alert alert-info mb-3" style="display: flex; align-items: center; gap: 10px;">
                            <i class="bi bi-calculator"></i>
                            <div>
                                <strong>å‰©ä½™æ€»é‡‘é¢ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰ï¼š</strong>
                                <span id="remainingAmountDisplay" style="font-size: 20px; color: #f44336; font-weight: bold;">Â¥0.00</span>
                            </div>
                        </div>
                        <input type="hidden" id="remainingAmount">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">æ€»å€Ÿæ¬¾é‡‘é¢</label>
                                <input type="number" class="form-control" id="totalAmount" step="0.01">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">å¼€å§‹æ—¥æœŸ</label>
                                <input type="date" class="form-control" id="startDate">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">å¤‡æ³¨</label>
                            <textarea class="form-control" id="note" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" onclick="saveLoan()">ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <!-- è¿˜æ¬¾æ¨¡æ€æ¡† -->
    <div class="modal fade" id="paymentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">è®°å½•è¿˜æ¬¾</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="paymentLoanId">
                    <div class="mb-3">
                        <label class="form-label">è´·æ¬¾</label>
                        <input type="text" class="form-control" id="paymentLoanName" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">è¿˜æ¬¾é‡‘é¢</label>
                        <input type="number" class="form-control" id="paymentAmount" step="0.01">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">è¿˜æ¬¾æ—¥æœŸ</label>
                        <input type="date" class="form-control" id="paymentDate">
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="autoDeduct" checked>
                            <label class="form-check-label" for="autoDeduct">
                                è‡ªåŠ¨æ‰£å‡ä½™é¢
                            </label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">å¤‡æ³¨</label>
                        <input type="text" class="form-control" id="paymentNote">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" onclick="savePayment()">ç¡®è®¤è¿˜æ¬¾</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/api.js"></script>
    <script>
        let loanModal, paymentModal;
        let currentLoan = null;

        document.addEventListener('DOMContentLoaded', function() {
            loanModal = new bootstrap.Modal(document.getElementById('loanModal'));
            paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));
            loadLoans();
        });

        async function loadLoans() {
            try {
                const loans = await API.loans.getAll();
                const summary = await API.loans.getSummary();
                
                // æ›´æ–°æ±‡æ€»
                document.getElementById('totalDebt').textContent = 'Â¥' + Utils.formatMoney(summary.totalDebt);
                document.getElementById('monthlyPaymentSummary').textContent = 'Â¥' + Utils.formatMoney(summary.monthlyPayment);
                document.getElementById('activeCount').textContent = summary.activeLoans;
                document.getElementById('completedCount').textContent = summary.completedLoans;
                
                // æ¸²æŸ“å¹³å°æ±‡æ€»ï¼ˆè°ƒç”¨åç«¯APIï¼‰
                renderPlatformSummary();
                
                // æ¸²æŸ“åˆ—è¡¨
                const tbody = document.getElementById('loansList');
                tbody.innerHTML = loans.map(loan => `
                    <tr>
                        <td>
                            <a href="loan-detail.html?id=${loan.id}" style="text-decoration: none; color: #667eea; font-weight: bold;">
                                ${loan.loanName}
                                <i class="bi bi-box-arrow-up-right" style="font-size: 12px;"></i>
                            </a>
                        </td>
                        <td>${loan.platform || '-'}</td>
                        <td class="amount-negative">Â¥${Utils.formatMoney(loan.remainingAmount)}</td>
                        <td>Â¥${Utils.formatMoney(loan.monthlyPayment)}</td>
                        <td>æ¯æœˆ${loan.paymentDay}å·</td>
                        <td>
                            ${loan.status === 'active' ? '<span class="badge bg-primary">è¿˜æ¬¾ä¸­</span>' : 
                              loan.status === 'completed' ? '<span class="badge bg-success">å·²ç»“æ¸…</span>' : 
                              '<span class="badge bg-danger">é€¾æœŸ</span>'}
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-info" onclick="window.location.href='loan-detail.html?id=${loan.id}'" title="è¯¦æƒ…">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-outline-primary" onclick='editLoan(${JSON.stringify(loan)})' title="ç¼–è¾‘">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-outline-success" onclick="showPaymentModal(${loan.id}, '${loan.loanName}', ${loan.monthlyPayment})" title="è¿˜æ¬¾">
                                    <i class="bi bi-cash"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteLoan(${loan.id})" title="åˆ é™¤">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                Utils.showError('åŠ è½½è´·æ¬¾å¤±è´¥');
            }
        }

        function showAddModal() {
            currentLoan = null;
            document.getElementById('modalTitle').textContent = 'æ·»åŠ è´·æ¬¾';
            document.getElementById('loanForm').reset();
            document.getElementById('loanId').value = '';
            
            // è®¾ç½®é»˜è®¤å€¼
            document.getElementById('paidPeriods').value = '0';
            document.getElementById('remainingPeriods').value = '';
            document.getElementById('remainingAmountDisplay').textContent = 'Â¥0.00';
            
            loanModal.show();
        }

        function editLoan(loan) {
            currentLoan = loan;
            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘è´·æ¬¾';
            document.getElementById('loanId').value = loan.id;
            document.getElementById('loanName').value = loan.loanName;
            document.getElementById('platform').value = loan.platform || '';
            document.getElementById('monthlyPayment').value = loan.monthlyPayment || '';
            document.getElementById('paymentDay').value = loan.paymentDay || '';
            document.getElementById('totalAmount').value = loan.totalAmount || '';
            document.getElementById('totalPeriods').value = loan.totalPeriods || '';
            document.getElementById('paidPeriods').value = loan.paidPeriods !== null && loan.paidPeriods !== undefined ? loan.paidPeriods : '';
            document.getElementById('startDate').value = loan.startDate || '';
            document.getElementById('note').value = loan.note || '';
            
            // å¡«å……åè®¡ç®—ä¸€æ¬¡
            setTimeout(() => {
                calculateRemainingAmount();
            }, 100);
            
            loanModal.show();
        }

        // è®¡ç®—å‰©ä½™é‡‘é¢ï¼ˆä»…ç”¨äºå‰ç«¯æ˜¾ç¤ºé¢„è§ˆï¼‰
        function calculateRemainingAmount() {
            const monthlyPayment = parseFloat(document.getElementById('monthlyPayment').value) || 0;
            const totalPeriods = parseInt(document.getElementById('totalPeriods').value) || 0;
            const paidPeriods = parseInt(document.getElementById('paidPeriods').value) || 0;
            
            const remainingPeriods = totalPeriods - paidPeriods;
            const remainingAmount = remainingPeriods * monthlyPayment;
            
            document.getElementById('remainingPeriods').value = remainingPeriods;
            document.getElementById('remainingAmountDisplay').textContent = 'Â¥' + remainingAmount.toLocaleString('zh-CN', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            
            // æ³¨æ„ï¼šå®é™…ä¿å­˜æ—¶ç”±åç«¯è®¡ç®—ï¼Œè¿™é‡Œåªæ˜¯é¢„è§ˆ
        }

        async function saveLoan() {
            // éªŒè¯å¿…å¡«å­—æ®µ
            const loanName = document.getElementById('loanName').value.trim();
            const monthlyPaymentStr = document.getElementById('monthlyPayment').value;
            const paymentDayStr = document.getElementById('paymentDay').value;
            const totalPeriodsStr = document.getElementById('totalPeriods').value;
            const paidPeriodsStr = document.getElementById('paidPeriods').value;
            
            if (!loanName) {
                alert('è¯·å¡«å†™è´·æ¬¾åç§°');
                return;
            }
            
            const monthlyPayment = parseFloat(monthlyPaymentStr);
            if (!monthlyPaymentStr || isNaN(monthlyPayment) || monthlyPayment <= 0) {
                alert('è¯·å¡«å†™æ­£ç¡®çš„æ¯æœŸè¿˜æ¬¾é‡‘é¢');
                return;
            }
            
            const paymentDay = parseInt(paymentDayStr);
            if (!paymentDayStr || isNaN(paymentDay) || paymentDay < 1 || paymentDay > 31) {
                alert('è¯·å¡«å†™æ­£ç¡®çš„è¿˜æ¬¾æ—¥ï¼ˆ1-31ï¼‰');
                return;
            }
            
            const totalPeriods = parseInt(totalPeriodsStr);
            if (!totalPeriodsStr || isNaN(totalPeriods) || totalPeriods <= 0) {
                alert('è¯·å¡«å†™æ€»æœŸæ•°');
                return;
            }
            
            const paidPeriods = parseInt(paidPeriodsStr);
            if (paidPeriodsStr === '' || isNaN(paidPeriods) || paidPeriods < 0) {
                alert('è¯·å¡«å†™å·²è¿˜æœŸæ•°ï¼ˆæ–°è´·æ¬¾å¡«0ï¼‰');
                return;
            }
            
            const loanData = {
                loanName: loanName,
                platform: document.getElementById('platform').value || '',
                monthlyPayment: monthlyPayment,
                paymentDay: paymentDay,
                totalPeriods: totalPeriods,
                paidPeriods: paidPeriods,
                // remainingAmount ç”±åç«¯è‡ªåŠ¨è®¡ç®—ï¼Œä¸éœ€è¦ä¼ 
                totalAmount: parseFloat(document.getElementById('totalAmount').value) || null,
                startDate: document.getElementById('startDate').value || null,
                note: document.getElementById('note').value || ''
            };

            // è°ƒè¯•ï¼šæ‰“å°æ•°æ®
            console.log('ä¿å­˜è´·æ¬¾æ•°æ®:', loanData);

            try {
                const id = document.getElementById('loanId').value;
                if (id) {
                    await API.loans.update(id, loanData);
                } else {
                    await API.loans.add(loanData);
                }
                loanModal.hide();
                loadLoans();
                alert('âœ“ ä¿å­˜æˆåŠŸï¼');
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                alert('âŒ ä¿å­˜å¤±è´¥ï¼š' + (error.message || 'æœªçŸ¥é”™è¯¯'));
            }
        }

        function showPaymentModal(loanId, loanName, amount) {
            document.getElementById('paymentLoanId').value = loanId;
            document.getElementById('paymentLoanName').value = loanName;
            document.getElementById('paymentAmount').value = amount;
            document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];
            paymentModal.show();
        }

        async function savePayment() {
            const data = {
                amount: document.getElementById('paymentAmount').value,
                paymentDate: document.getElementById('paymentDate').value,
                autoDeduct: document.getElementById('autoDeduct').checked,
                note: document.getElementById('paymentNote').value
            };

            try {
                const loanId = document.getElementById('paymentLoanId').value;
                await API.loans.recordPayment(loanId, data);
                paymentModal.hide();
                loadLoans();
                alert('è¿˜æ¬¾è®°å½•æˆåŠŸï¼');
            } catch (error) {
                Utils.showError('è®°å½•å¤±è´¥');
            }
        }

        // æ¸²æŸ“å¹³å°æ±‡æ€»ï¼ˆè°ƒç”¨åç«¯APIï¼‰
        async function renderPlatformSummary() {
            try {
                const response = await fetch(`${API_BASE_URL}/loans/platform-summary`);
                const platforms = await response.json();
                
                const tbody = document.getElementById('platformSummary');
                
                if (platforms.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">æš‚æ— è´·æ¬¾</td></tr>';
                    return;
                }
                
                tbody.innerHTML = platforms.map(data => `
                    <tr>
                        <td><strong><i class="bi bi-building"></i> ${data.platform}</strong></td>
                        <td class="text-end"><strong style="color: #f44336; font-size: 16px;">Â¥${data.totalDebt.toLocaleString('zh-CN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong></td>
                        <td class="text-center"><span class="badge bg-primary">${data.count} ç¬”</span></td>
                        <td class="text-end" style="color: #FF9800; font-weight: bold;">Â¥${data.monthlyPayment.toFixed(2)}</td>
                    </tr>
                `).join('');
                
                // æ·»åŠ åˆè®¡è¡Œ
                const totalDebt = platforms.reduce((sum, data) => sum + data.totalDebt, 0);
                const totalCount = platforms.reduce((sum, data) => sum + data.count, 0);
                const totalMonthly = platforms.reduce((sum, data) => sum + data.monthlyPayment, 0);
                
                tbody.innerHTML += `
                    <tr style="background: #f8f9fa; font-weight: bold; border-top: 2px solid #667eea;">
                        <td>ğŸ“Š åˆè®¡</td>
                        <td class="text-end" style="color: #f44336; font-size: 18px;">Â¥${totalDebt.toLocaleString('zh-CN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                        <td class="text-center"><span class="badge bg-secondary">${totalCount} ç¬”</span></td>
                        <td class="text-end" style="color: #FF9800; font-size: 16px;">Â¥${totalMonthly.toFixed(2)}</td>
                    </tr>
                `;
            } catch (error) {
                console.error('åŠ è½½å¹³å°æ±‡æ€»å¤±è´¥:', error);
            }
        }

        async function deleteLoan(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¬”è´·æ¬¾å—ï¼Ÿ')) return;
            try {
                await API.loans.delete(id);
                loadLoans();
            } catch (error) {
                Utils.showError('åˆ é™¤å¤±è´¥');
            }
        }
    </script>
</body>
</html>

