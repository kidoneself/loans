<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å½•å…¥ - è´·æ¬¾ç®¡ç†ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .chat-container {
            max-width: 800px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .chat-header h5 {
            margin: 0;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-header .close-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }

        .chat-header .close-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .progress-bar-container {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-step {
            flex: 1;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            transition: all 0.3s;
        }

        .progress-step.completed {
            background: #4CAF50;
        }

        .progress-step.active {
            background: #FFD54F;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .message {
            margin-bottom: 20px;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.bot {
            display: flex;
            gap: 10px;
        }

        .message.user {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .message.bot .message-bubble {
            background: white;
            border-bottom-left-radius: 4px;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .quick-reply-btn {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 6px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .quick-reply-btn:hover {
            background: #667eea;
            color: white;
        }

        .summary-card {
            background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%);
            border-left: 4px solid #FF9800;
            padding: 15px;
            border-radius: 12px;
            margin-top: 10px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed rgba(0,0,0,0.1);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }

        .input-group-custom {
            display: flex;
            gap: 10px;
        }

        .input-group-custom input {
            flex: 1;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 15px;
            outline: none;
            transition: all 0.3s;
        }

        .input-group-custom input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group-custom button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .input-group-custom button:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .input-group-custom button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .action-buttons button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary-custom {
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            color: white;
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        .btn-secondary-custom {
            background: #f5f5f5;
            color: #666;
        }

        .btn-secondary-custom:hover {
            background: #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="chat-header">
            <h5>
                <i class="bi bi-chat-dots"></i>
                æ™ºèƒ½å½•å…¥åŠ©æ‰‹
            </h5>
            <button class="close-btn" onclick="closeChatInput()">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>

        <!-- è¿›åº¦æ¡ -->
        <div class="progress-bar-container">
            <div class="progress-step" id="step0"></div>
            <div class="progress-step" id="step1"></div>
            <div class="progress-step" id="step2"></div>
            <div class="progress-step" id="step3"></div>
            <div class="progress-step" id="step4"></div>
            <div class="progress-step" id="step5"></div>
            <div class="progress-step" id="step6"></div>
            <div class="progress-step" id="step7"></div>
        </div>

        <!-- æ¶ˆæ¯åŒºåŸŸ -->
        <div class="messages-container" id="messagesContainer">
            <!-- æ¶ˆæ¯å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
        </div>

        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="input-container">
            <div class="input-group-custom">
                <input type="text" id="userInput" placeholder="è¾“å…¥ä½ çš„å›ç­”..." 
                       onkeypress="handleKeyPress(event)">
                <button onclick="sendMessage()" id="sendBtn">
                    <i class="bi bi-send-fill"></i>
                </button>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
        // å½“å‰æ­¥éª¤
        let currentStep = 0;
        
        // è´·æ¬¾æ•°æ®
        let loanData = {
            loanName: '',
            remainingAmount: 0,
            monthlyPayment: 0,
            paymentDay: 0,
            platform: '',
            totalAmount: 0,
            totalPeriods: 0,
            paidPeriods: 0,
            startDate: '',
            note: ''
        };

        // é—®é¢˜åˆ—è¡¨
        const questions = [
            {
                text: 'ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ¥å¸®ä½ æ·»åŠ è´·æ¬¾ä¿¡æ¯\n\nç¬¬ä¸€ä¸ªé—®é¢˜ï¼š\nè¿™ç¬”è´·æ¬¾å«ä»€ä¹ˆåå­—ï¼Ÿ\nï¼ˆæ¯”å¦‚ï¼šæ‹æ‹è´·2025.08.25ã€æ‹›è”é‡‘èç­‰ï¼‰',
                field: 'loanName',
                type: 'text',
                required: true
            },
            {
                text: 'è¿™ç¬”è´·æ¬¾æ˜¯å“ªä¸ªå¹³å°çš„ï¼Ÿ\nï¼ˆæ¯”å¦‚ï¼šæ‹æ‹è´·ã€æ‹›è”é‡‘èã€ä¿¡ç”¨é£ã€åˆ†æœŸä¹ç­‰ï¼‰',
                field: 'platform',
                type: 'text',
                required: true,
                quickReplies: ['æ‹æ‹è´·', 'æ‹›è”é‡‘è', 'ä¿¡ç”¨é£', 'åˆ†æœŸä¹', 'å…¶ä»–']
            },
            {
                text: 'æ¯ä¸ªæœˆè¦è¿˜å¤šå°‘é’±ï¼Ÿ\nï¼ˆæ¯”å¦‚ï¼š954.09ï¼‰',
                field: 'monthlyPayment',
                type: 'number',
                required: true,
                suffix: 'å…ƒ'
            },
            {
                text: 'æ€»å…±åˆ†å¤šå°‘æœŸè¿˜æ¬¾ï¼Ÿ\nï¼ˆæ¯”å¦‚ï¼š12æœŸã€18æœŸç­‰ï¼‰',
                field: 'totalPeriods',
                type: 'number',
                required: true,
                suffix: 'æœŸ'
            },
            {
                text: 'å·²ç»è¿˜äº†å¤šå°‘æœŸï¼Ÿ\nï¼ˆå¦‚æœæ˜¯æ–°è´·æ¬¾è¾“å…¥0ï¼Œæ¯”å¦‚ï¼šå·²è¿˜2æœŸå°±è¾“å…¥2ï¼‰',
                field: 'paidPeriods',
                type: 'number',
                required: true,
                defaultValue: 0,
                suffix: 'æœŸ'
            },
            {
                text: 'æ¯æœˆå‡ å·è¿˜æ¬¾ï¼Ÿ\nï¼ˆè¾“å…¥1-31ä¹‹é—´çš„æ•°å­—ï¼‰',
                field: 'paymentDay',
                type: 'number',
                required: true,
                validate: (val) => val >= 1 && val <= 31,
                errorMsg: 'æ—¥æœŸåº”åœ¨1-31ä¹‹é—´'
            },
            {
                text: 'æ€»å…±å€Ÿäº†å¤šå°‘é’±ï¼Ÿï¼ˆåŸå§‹å€Ÿæ¬¾é‡‘é¢ï¼‰\nï¼ˆä¸è®°å¾—å¯ä»¥è¾“å…¥0è·³è¿‡ï¼‰',
                field: 'totalAmount',
                type: 'number',
                required: false,
                suffix: 'å…ƒ',
                defaultValue: 0
            }
        ];

        // é¡µé¢åŠ è½½æ—¶å¼€å§‹å¯¹è¯
        window.onload = function() {
            addBotMessage(questions[0].text);
            updateProgress();
        };

        // æ·»åŠ æœºå™¨äººæ¶ˆæ¯
        function addBotMessage(text, delay = 0) {
            setTimeout(() => {
                const container = document.getElementById('messagesContainer');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message bot';
                messageDiv.innerHTML = `
                    <div class="message-avatar">ğŸ¤–</div>
                    <div class="message-bubble">${text.replace(/\n/g, '<br>')}</div>
                `;
                container.appendChild(messageDiv);
                scrollToBottom();
            }, delay);
        }

        // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        function addUserMessage(text) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `
                <div class="message-bubble">${text}</div>
                <div class="message-avatar">ğŸ‘¤</div>
            `;
            container.appendChild(messageDiv);
            scrollToBottom();
        }

        // å¤„ç†å›è½¦é”®
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            const input = document.getElementById('userInput');
            const value = input.value.trim();

            if (!value) return;

            const question = questions[currentStep];
            
            // æ˜¾ç¤ºç”¨æˆ·è¾“å…¥
            addUserMessage(value);
            input.value = '';

            // è§£æè¾“å…¥
            let parsedValue = parseInput(value, question.type);

            // éªŒè¯è¾“å…¥
            if (question.validate && !question.validate(parsedValue)) {
                addBotMessage(`âŒ ${question.errorMsg}\n\nè¯·é‡æ–°è¾“å…¥ï¼š`, 500);
                return;
            }

            // ä¿å­˜æ•°æ®
            loanData[question.field] = parsedValue;

            // æ˜¾ç¤ºç¡®è®¤æ¶ˆæ¯
            let confirmText = `âœ… ${getFieldLabel(question.field)}ï¼š${formatValue(parsedValue, question)}`;
            addBotMessage(confirmText, 500);

            // è¿›å…¥ä¸‹ä¸€æ­¥
            currentStep++;
            updateProgress();

            if (currentStep < questions.length) {
                // ç»§ç»­ä¸‹ä¸€ä¸ªé—®é¢˜
                setTimeout(() => {
                    const nextQuestion = questions[currentStep];
                    addBotMessage(nextQuestion.text, 1000);
                    
                    // å¦‚æœæœ‰å¿«æ·å›å¤é€‰é¡¹
                    if (nextQuestion.quickReplies) {
                        showQuickReplies(nextQuestion.quickReplies);
                    }
                }, 1500);
            } else {
                // æ‰€æœ‰é—®é¢˜å®Œæˆï¼Œæ˜¾ç¤ºæ±‡æ€»
                showSummary();
            }
        }

        // æ˜¾ç¤ºå¿«æ·å›å¤æŒ‰é’®
        function showQuickReplies(replies) {
            setTimeout(() => {
                const container = document.getElementById('messagesContainer');
                const quickDiv = document.createElement('div');
                quickDiv.className = 'message bot';
                quickDiv.innerHTML = `
                    <div class="message-avatar">ğŸ¤–</div>
                    <div style="flex: 1;">
                        <div class="quick-replies">
                            ${replies.map(reply => 
                                `<button class="quick-reply-btn" onclick="selectQuickReply('${reply}')">${reply}</button>`
                            ).join('')}
                        </div>
                    </div>
                `;
                container.appendChild(quickDiv);
                scrollToBottom();
            }, 1800);
        }

        // é€‰æ‹©å¿«æ·å›å¤
        function selectQuickReply(value) {
            document.getElementById('userInput').value = value;
            sendMessage();
        }

        // è·³è¿‡å½“å‰é—®é¢˜
        function skipQuestion() {
            const question = questions[currentStep];
            
            if (question.defaultValue !== undefined) {
                loanData[question.field] = question.defaultValue;
            }
            
            addBotMessage(`â­ï¸ å·²è·³è¿‡ã€Œ${getFieldLabel(question.field)}ã€`, 300);
            
            currentStep++;
            updateProgress();

            if (currentStep < questions.length) {
                setTimeout(() => {
                    addBotMessage(questions[currentStep].text, 800);
                }, 1000);
            } else {
                showSummary();
            }
        }

        // è§£æè¾“å…¥
        function parseInput(value, type) {
            if (type === 'number') {
                // ç§»é™¤å¯èƒ½çš„ä¸­æ–‡å­—ç¬¦
                value = value.replace(/å…ƒ|å·|æ—¥/g, '').trim();
                return parseFloat(value) || 0;
            }
            return value;
        }

        // æ ¼å¼åŒ–æ˜¾ç¤ºå€¼
        function formatValue(value, question) {
            if (question.type === 'number') {
                if (question.field === 'paymentDay') {
                    return `æ¯æœˆ ${value} å·`;
                }
                if (question.field === 'totalPeriods' || question.field === 'paidPeriods') {
                    return `${value} æœŸ`;
                }
                return value.toLocaleString('zh-CN', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + (question.suffix || '');
            }
            return value;
        }

        // è·å–å­—æ®µæ ‡ç­¾
        function getFieldLabel(field) {
            const labels = {
                'loanName': 'è´·æ¬¾åç§°',
                'platform': 'æ‰€å±å¹³å°',
                'remainingAmount': 'å‰©ä½™é‡‘é¢',
                'monthlyPayment': 'æ¯æœˆè¿˜æ¬¾',
                'paymentDay': 'è¿˜æ¬¾æ—¥æœŸ',
                'totalPeriods': 'æ€»æœŸæ•°',
                'paidPeriods': 'å·²è¿˜æœŸæ•°',
                'totalAmount': 'æ€»å€Ÿæ¬¾é‡‘é¢',
                'startDate': 'å¼€å§‹æ—¥æœŸ',
                'note': 'å¤‡æ³¨'
            };
            return labels[field] || field;
        }

        // æ˜¾ç¤ºæ±‡æ€»ä¿¡æ¯
        function showSummary() {
            // è®¡ç®—å‰©ä½™æœŸæ•°å’Œå‰©ä½™é‡‘é¢
            const remainingPeriods = loanData.totalPeriods - loanData.paidPeriods;
            const remainingAmount = remainingPeriods * loanData.monthlyPayment;
            loanData.remainingAmount = remainingAmount;

            let summaryItems = `
                <div class="summary-item">
                    <span>è´·æ¬¾åç§°</span>
                    <strong>${loanData.loanName}</strong>
                </div>
                <div class="summary-item">
                    <span>æ‰€å±å¹³å°</span>
                    <strong>${loanData.platform}</strong>
                </div>
                <div class="summary-item">
                    <span>æ€»æœŸæ•° / å·²è¿˜æœŸæ•°</span>
                    <strong>${loanData.totalPeriods} æœŸ / ${loanData.paidPeriods} æœŸ</strong>
                </div>
                <div class="summary-item">
                    <span>å‰©ä½™æœŸæ•°</span>
                    <strong style="color: #2196F3;">${remainingPeriods} æœŸ</strong>
                </div>
                <div class="summary-item">
                    <span>æ¯æœˆè¿˜æ¬¾</span>
                    <strong style="color: #FF9800;">Â¥${loanData.monthlyPayment.toFixed(2)}</strong>
                </div>
                <div class="summary-item" style="background: #FFF3E0; padding: 8px; border-radius: 6px; margin-top: 5px;">
                    <span>å‰©ä½™æ€»é‡‘é¢ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰</span>
                    <strong style="color: #f44336; font-size: 18px;">Â¥${remainingAmount.toFixed(2)}</strong>
                </div>
                <div class="summary-item">
                    <span>è¿˜æ¬¾æ—¥æœŸ</span>
                    <strong>æ¯æœˆ ${loanData.paymentDay} å·</strong>
                </div>
            `;

            if (loanData.totalAmount) {
                summaryItems += `
                    <div class="summary-item">
                        <span>æ€»å€Ÿæ¬¾é‡‘é¢</span>
                        <strong>Â¥${loanData.totalAmount.toFixed(2)}</strong>
                    </div>
                `;
            }

            const summaryHTML = `
                <div class="summary-card">
                    <div style="font-weight: bold; margin-bottom: 10px; color: #FF9800;">
                        <i class="bi bi-check-circle-fill"></i> ä¿¡æ¯ç¡®è®¤
                    </div>
                    ${summaryItems}
                    <div style="margin-top: 10px; padding: 10px; background: rgba(102, 126, 234, 0.1); border-radius: 6px; font-size: 12px; color: #666;">
                        ğŸ’¡ å‰©ä½™é‡‘é¢ = å‰©ä½™æœŸæ•°(${remainingPeriods}) Ã— æ¯æœˆè¿˜æ¬¾(Â¥${loanData.monthlyPayment.toFixed(2)})
                    </div>
                </div>
            `;

            addBotMessage(summaryHTML, 500);

            // æ˜¾ç¤ºæ“ä½œæŒ‰é’®
            setTimeout(() => {
                const container = document.getElementById('messagesContainer');
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'message bot';
                actionsDiv.innerHTML = `
                    <div class="message-avatar">ğŸ¤–</div>
                    <div style="flex: 1;">
                        <div class="action-buttons">
                            <button class="btn-secondary-custom" onclick="modifyInfo()">
                                <i class="bi bi-pencil"></i> éœ€è¦ä¿®æ”¹
                            </button>
                            <button class="btn-primary-custom" onclick="saveLoan()">
                                <i class="bi bi-check-circle"></i> ç¡®è®¤ä¿å­˜
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(actionsDiv);
                scrollToBottom();
            }, 1000);
        }

        // ä¿å­˜è´·æ¬¾
        async function saveLoan() {
            try {
                // ç¦ç”¨æŒ‰é’®
                document.getElementById('sendBtn').disabled = true;

                const loan = {
                    loanName: loanData.loanName,
                    platform: loanData.platform,
                    remainingAmount: loanData.remainingAmount,
                    monthlyPayment: loanData.monthlyPayment,
                    paymentDay: loanData.paymentDay,
                    totalPeriods: loanData.totalPeriods || null,
                    paidPeriods: loanData.paidPeriods || 0,
                    totalAmount: loanData.totalAmount || null,
                    status: 'active'
                };

                const response = await fetch(`${API_BASE_URL}/loans`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(loan)
                });

                if (response.ok) {
                    addBotMessage('ğŸ‰ å¤ªæ£’äº†ï¼è´·æ¬¾å·²ä¿å­˜æˆåŠŸï¼', 300);
                    
                    setTimeout(() => {
                        const continueHTML = `
                            <div class="action-buttons">
                                <button class="btn-primary-custom" onclick="addAnother()">
                                    <i class="bi bi-plus-circle"></i> ç»§ç»­æ·»åŠ ä¸‹ä¸€ç¬”
                                </button>
                                <button class="btn-secondary-custom" onclick="goToLoans()">
                                    <i class="bi bi-list-ul"></i> æŸ¥çœ‹è´·æ¬¾åˆ—è¡¨
                                </button>
                            </div>
                        `;
                        const container = document.getElementById('messagesContainer');
                        const actionsDiv = document.createElement('div');
                        actionsDiv.className = 'message bot';
                        actionsDiv.innerHTML = `
                            <div class="message-avatar">ğŸ¤–</div>
                            <div style="flex: 1;">${continueHTML}</div>
                        `;
                        container.appendChild(actionsDiv);
                        scrollToBottom();
                    }, 800);
                } else {
                    throw new Error('ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                addBotMessage('âŒ ä¿å­˜å¤±è´¥ï¼š' + error.message + '\n\nè¯·é‡è¯•', 500);
                document.getElementById('sendBtn').disabled = false;
            }
        }

        // ä¿®æ”¹ä¿¡æ¯
        function modifyInfo() {
            addBotMessage('å¥½çš„ï¼Œä½ æƒ³ä¿®æ”¹å“ªä¸€é¡¹ï¼Ÿ', 300);
            
            setTimeout(() => {
                const container = document.getElementById('messagesContainer');
                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'message bot';
                optionsDiv.innerHTML = `
                    <div class="message-avatar">ğŸ¤–</div>
                    <div style="flex: 1;">
                        <div class="quick-replies">
                            <button class="quick-reply-btn" onclick="modifyField('loanName', 0)">è´·æ¬¾åç§°</button>
                            <button class="quick-reply-btn" onclick="modifyField('platform', 1)">å¹³å°</button>
                            <button class="quick-reply-btn" onclick="modifyField('remainingAmount', 2)">å‰©ä½™é‡‘é¢</button>
                            <button class="quick-reply-btn" onclick="modifyField('monthlyPayment', 3)">æ¯æœˆè¿˜æ¬¾</button>
                            <button class="quick-reply-btn" onclick="modifyField('paymentDay', 4)">è¿˜æ¬¾æ—¥æœŸ</button>
                            <button class="quick-reply-btn" onclick="modifyField('totalPeriods', 5)">æ€»æœŸæ•°</button>
                            <button class="quick-reply-btn" onclick="modifyField('paidPeriods', 6)">å·²è¿˜æœŸæ•°</button>
                        </div>
                    </div>
                `;
                container.appendChild(optionsDiv);
                scrollToBottom();
            }, 500);
        }

        // ä¿®æ”¹æŒ‡å®šå­—æ®µ
        function modifyField(field, step) {
            currentStep = step;
            addBotMessage(questions[step].text, 300);
        }

        // ç»§ç»­æ·»åŠ ä¸‹ä¸€ç¬”
        function addAnother() {
            // é‡ç½®æ•°æ®
            loanData = {
                loanName: '',
                platform: '',
                remainingAmount: 0,
                monthlyPayment: 0,
                paymentDay: 0,
                totalPeriods: 0,
                paidPeriods: 0,
                totalAmount: 0,
                startDate: '',
                note: ''
            };
            currentStep = 0;
            
            // æ¸…ç©ºæ¶ˆæ¯
            document.getElementById('messagesContainer').innerHTML = '';
            
            // é‡æ–°å¼€å§‹
            addBotMessage('å¥½çš„ï¼Œæˆ‘ä»¬æ¥æ·»åŠ ä¸‹ä¸€ç¬”è´·æ¬¾ï¼\n\n' + questions[0].text);
            updateProgress();
            document.getElementById('sendBtn').disabled = false;
        }

        // è·³è½¬åˆ°è´·æ¬¾åˆ—è¡¨
        function goToLoans() {
            window.location.href = 'loans.html';
        }

        // å…³é—­å¯¹è¯å½•å…¥
        function closeChatInput() {
            if (confirm('ç¡®å®šè¦é€€å‡ºå—ï¼Ÿæœªä¿å­˜çš„æ•°æ®ä¼šä¸¢å¤±ã€‚')) {
                window.location.href = 'loans.html';
            }
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            for (let i = 0; i < questions.length; i++) {
                const step = document.getElementById(`step${i}`);
                if (!step) continue;
                
                if (i < currentStep) {
                    step.className = 'progress-step completed';
                } else if (i === currentStep) {
                    step.className = 'progress-step active';
                } else {
                    step.className = 'progress-step';
                }
            }
        }

        // æ»šåŠ¨åˆ°åº•éƒ¨
        function scrollToBottom() {
            const container = document.getElementById('messagesContainer');
            setTimeout(() => {
                container.scrollTop = container.scrollHeight;
            }, 100);
        }
    </script>
</body>
</html>

